name: Build Clang

on: [push]

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
    - uses: actions/checkout@v2

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y bc \
            binutils-dev \
            bison \
            build-essential \
            ca-certificates \
            ccache \
            clang \
            cmake \
            curl \
            file \
            flex \
            git \
            libelf-dev \
            libssl-dev \
            lld \
            make \
            ninja-build \
            python3-dev \
            texinfo \
            u-boot-tools \
            xz-utils \
            zlib1g-dev \
            tar \
            curl \
            patchelf \
            megatools

    - name: Build Clang 22.0.0
      run: |
        sudo fallocate -l 8G /swapfile
        sudo chmod 600 /swapfile
        sudo mkswap /swapfile
        sudo swapon /swapfile
        mkdir build
        cd build
        git clone https://github.com/onettboots/boolx-clang-build -b zb
        cd boolx-clang-build
        git config --global user.name "onettboots"
        git config --global user.email "blackcocopet@gmail.com"
        bash clang-builder.sh
        tar -czf clang22.tar.gz install
        #curl bashupload.com -T clang20.tar.gz
        megadl https://mega.nz/file/PgFASLLI#ALHx8iXazBkgkKQFQ9bVY26DKcFNZ8pSkcgpOelWJwE
        tar -xf ssh.tar.gz
        ssh -i onettboots clang22.tar.gz onettboots@192.168.100.228:/home/onettboots/toolchain
